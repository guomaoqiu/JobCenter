{% extends "base.html" %}

{% block page_content %}

<link href="https://magicbox.bk.tencent.com/static_api/v3/assets/bootstrap-3.3.4/css/bootstrap.min.css" rel="stylesheet"/>
<link href="https://magicbox.bk.tencent.com/static_api/v3/assets/datatables-1.10.7/dataTables.bootstrap.css" rel="stylesheet"/>
<!-- <link href="https://magicbox.bk.tencent.com/static_api/v3/bk/css/bk.css" rel="stylesheet"> -->
<script src="https://magicbox.bk.tencent.com/static_api/v3/assets/js/jquery-1.10.2.min.js"></script>
<script src="https://magicbox.bk.tencent.com/static_api/v3/assets/datatables-1.10.7/jquery.dataTables.js"></script>
<script src="https://magicbox.bk.tencent.com/static_api/v3/assets/datatables-1.10.7/dataTables.bootstrap.js"></script>

<div class="row wrapper border-bottom white-bg page-heading">
        <div class="col-lg-12">
            <ol class="breadcrumb">
                <li class="active">
                    <strong>ğŸ˜</strong><br>
                </li>
            </ol>
        </div>

    </div>
    <div class="wrapper wrapper-content animated fadeInRight">
        <div class="row">
            <div class="col-lg-12">


                <div class="ibox float-e-margins">
                    <div class="ibox-content">
                        <div id="ct-chart1" class="ct-perfect-fourth"></div>
                                    <div class="panel-content">
                                      
                                      <a class="btn btn-xs btn-danger" id="deleteAll" title="åˆ é™¤">æ¸…ç©ºä»»åŠ¡æ—¥å¿—</a>
                                      <table id="table2_demo4" class="table table-bordered table-striped dataTable no-footer" role="grid" aria-describedby="table2_demo4_info">
                                          <thead>
                                                  <th class="sorting_asc" rowspan="1" colspan="1" aria-label="åç§°">id</th>
                                                  <th class="sorting" tabindex="0" aria-controls="table2_demo4" rowspan="1" colspan="1" aria-label="èŒä½: activate to sort column ascending">ä»»åŠ¡ID</th>
                                                  <!-- <th class="sorting" tabindex="0" aria-controls="table2_demo4" rowspan="1" colspan="1" aria-label="å·¥èµ„: activate to sort column ascending">æ—¶é—´</th> -->
                                                  <th class="sorting" tabindex="0" aria-controls="table2_demo4" rowspan="1" colspan="1" aria-label="å¼€å§‹æ—¶é—´: activate to sort column ascending">çŠ¶æ€</th>
                                                  <th class="sorting" tabindex="0" aria-controls="table2_demo4" rowspan="1" colspan="1" aria-label="ä½ç½®: activate to sort column ascending">æ‰§è¡Œæ—¶é—´</th>
                                                  <th class="sorting" tabindex="0" aria-controls="table2_demo4" rowspan="1" colspan="1" aria-label="ä½ç½®: activate to sort column ascending">æ‰§è¡Œå‘½ä»¤</th>
                                              <!--     <th class="sorting" tabindex="0" aria-controls="table2_demo4" rowspan="1" colspan="1" aria-label="ä½ç½®: activate to sort column ascending">æ‰§è¡Œè¾“å‡º</th> -->
                                                  <th class="sorting_disabled" rowspan="1" colspan="1" aria-label="æ“ä½œ">æ“ä½œ</th>
                                              </tr>
                                          </thead>
                                          
                                      </table>

                                        <div class="col-md-4">
                                          

                                        </div>
                                        <div class="col-lg-8"></div>
                                       
                                      </div>
                                  </div>
                                 </div>
                              </div>
                          </div>
                      </div>
    

<script type="text/javascript">
    //è¡¨æ ¼(DataTables)-4ï¼Œç»¼åˆç¤ºä¾‹
    var language = {
      search: 'æœç´¢ï¼š',
      lengthMenu: "æ¯é¡µæ˜¾ç¤º _MENU_ è®°å½•",
      zeroRecords: "æ²¡æ‰¾åˆ°ç›¸åº”çš„æ•°æ®ï¼",
      info: "åˆ†é¡µ _PAGE_ / _PAGES_",
      infoEmpty: "æš‚æ— æ•°æ®ï¼",
      infoFiltered: "(ä» _MAX_ æ¡æ•°æ®ä¸­æœç´¢)",
      paginate: {
        first: 'é¦–é¡µ',
        last: 'å°¾é¡µ',
        previous: 'ä¸Šä¸€é¡µ',
        next: 'ä¸‹ä¸€é¡µ',
      }
    }
  

    $("#table2_demo4").dataTable({
        autoWidth: false,
        lengthChange: true, //ä¸å…è®¸ç”¨æˆ·æ”¹å˜è¡¨æ ¼æ¯é¡µæ˜¾ç¤ºçš„è®°å½•æ•°
        pageLength : 15, //æ¯é¡µæ˜¾ç¤ºå‡ æ¡æ•°æ®
        lengthMenu: [5, 10, 20], //æ¯é¡µæ˜¾ç¤ºé€‰é¡¹
        pagingType: 'full_numbers',
        ajax : 'v1/cron/job/job_log',
        ordering: false,
        columns : [
          {data:"id",orderable: false},
          {data:"task_id",orderable: false},
          // {data:"next_run_time"},
          {data:"status",orderable: false},
          {data:"exe_time",orderable: false},
          {data:"cmd",orderable: false},
          // {data:"stdout"},
          {
            data:null,
            orderable:false,
            render : function(data, type, row, meta){
                return "<a class='btn btn-sm btn-danger del'>åˆ é™¤</a> <a class='btn btn-sm btn-success job_info'>è¾“å‡º</a>"
            }
          }

        ],
        language:language

    });

    //=============================================================================== action.js
    //======== å…¬å…±ä½¿ç”¨:
    var t = $("#table2_demo4").DataTable();//è·å–datatableså¯¹è±¡

    // åˆ é™¤ä»»åŠ¡æŒ‰é’®ç»‘å®šäº‹ä»¶
    $("#table2_demo4 tbody").on('click', 'a.del', function(){
        var row = t.row( $(this).parents('tr') ),//è·å–æŒ‰é’®æ‰€åœ¨çš„è¡Œ
          data = row.data();
          // alert(data.id)
                  swal({
                  title: "æ˜¯å¦ç¡®å®šåˆ é™¤ä»»åŠ¡: " + data.task_id + "çš„æ—¥å¿—ï¼Ÿ",
                  text: "^o^",
                  type: "warning",
                  showCancelButton: true,
                  showLoaderOnConfirm: true,
                  confirmButtonColor: "#DD6B55",
                  confirmButtonText: "åˆ é™¤~",
                  cancelButtonText: "æˆ‘åœ¨æƒ³æƒ³å§...",
                  closeOnConfirm: true,
                  closeOnCancel: true  //å…³é—­å–æ¶ˆåè¿˜å¼¹å‡ºè®©ä½ ç¡®è®¤çš„æ•ˆæœæç¤º
                },
                  function(isConfirm){
                      if (isConfirm) {
                        $.ajax ({
                                type:'DELETE',
                                url:"{{url_for('main.dellog')}}",
                                contentType:'application/json',
                                datatype: "json",
                                data: JSON.stringify({"id": data.id}),
                                success:function(res){   //å°†å¤„ç†çš„ç»“æœè¿›è¡Œåˆ¤æ–­ï¼Œæ ¹æ®æ‰§è¡Œå¤±è´¥ï¼ŒæˆåŠŸç°å®çš„æç¤ºä¸åŒçš„å†…å®¹
                                    console.log(res)
                                    if (res.status) {
                                        swal(res.msg, "", "success");
                                        row.remove().draw();
                                    }
                                    else {
                                        swal(res.msg, "", "error");
                                    }
                                }
                            });
                         }
                    });
             });
   
    //è¯¦æƒ…æŒ‰é’®ç»‘å®šäº‹ä»¶
    $("#table2_demo4 tbody").on('click', 'a.job_info', function(){
        var row = t.row( $(this).parents('tr') ),//è·å–æŒ‰é’®æ‰€åœ¨çš„è¡Œ
          data = row.data();
          var id = data['id']
            layer.open({
              type: 2 ,
              skin: 'layui-layer-demo', //æ ·å¼ç±»å
              closeBtn: 1, //ä¸æ˜¾ç¤ºå…³é—­æŒ‰é’®
              title: "Stdout",
              anim: 2,
              area: '800px',
              shade: [0.8, '#393D49'],
              shadeClose: true, //å¼€å¯é®ç½©å…³é—­
              content: '/stdout/' +  id,
              success: function(layero,index) {
                layer.iframeAuto(index)
              }
            });
    });
    // // åˆ é™¤ä»»åŠ¡æŒ‰é’®ç»‘å®šäº‹ä»¶
    // $("#table2_demo4 tbody").on('click', 'a.del_job_log', function(){
    //     var row = t.row( $(this).parents('tr') ),//è·å–æŒ‰é’®æ‰€åœ¨çš„è¡Œ
    //       data = row.data();
    //       // alert(data.id)
    //               swal({
    //               title: "æ˜¯å¦ç¡®å®šåˆ é™¤ä»»åŠ¡: " + data.task_id + "çš„æ—¥å¿—ï¼Ÿ",
    //               text: "^o^",
    //               type: "warning",
    //               showCancelButton: true,
    //               showLoaderOnConfirm: true,
    //               confirmButtonColor: "#DD6B55",
    //               confirmButtonText: "åˆ é™¤~",
    //               cancelButtonText: "æˆ‘åœ¨æƒ³æƒ³å§...",
    //               closeOnConfirm: false,
    //               closeOnCancel: true  //å…³é—­å–æ¶ˆåè¿˜å¼¹å‡ºè®©ä½ ç¡®è®¤çš„æ•ˆæœæç¤º
    //             },
    //               function(isConfirm){
    //                   if (isConfirm) {
    //                     $.ajax ({
    //                             type:'DELETE',
    //                             url:"{{ url_for('main.dellog') }}",
    //                             contentType:'application/json',
    //                             datatype: "json",
    //                             data: JSON.stringify({"id": data.id}),

    //                             success:function(res){   //å°†å¤„ç†çš„ç»“æœè¿›è¡Œåˆ¤æ–­ï¼Œæ ¹æ®æ‰§è¡Œå¤±è´¥ï¼ŒæˆåŠŸç°å®çš„æç¤ºä¸åŒçš„å†…å®¹
    //                                 console.log(res)
    //                                 if (res.status) {
    //                                     swal(res.msg, "", "success");
    //                                     row.remove().draw();
    //                                 }
    //                                 else {
    //                                     swal(res.msg, "", "error");
    //                                 }
    //                             }
    //                         });
    //                      }
    //                 });
    //          });

</script>

{% endblock %}
